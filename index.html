<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Michigan Mortgage Calculator – 2024 Michigan Millage, Taxes & Monthly Payment</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Canonical URL -->
  <link rel="canonical" href="https://michiganmortgagecalculator.org/" />

  <!-- SEO Description -->
  <meta name="description" content="Calculate your Michigan mortgage payment with accurate 2024 millage property taxes. Includes PMI, insurance, and amortization. Fast, simple, and Michigan-specific." />

  <!-- Keywords -->
  <meta name="keywords" content="Michigan mortgage calculator, Michigan property tax calculator, millage rates, 2024 Michigan taxes, PMI calculator Michigan" />

  <!-- Google Search Console Verification -->
  <meta name="google-site-verification" content="uJ4hk7yJuv8LHqrCEiFtQOGfmhZ7CqYCpsd8QdF_f1c" />

  <!-- Favicons -->
  <link rel="icon" href="michigan-mortgage-calculator-thumbnail.png" type="image/png" />
  <link rel="apple-touch-icon" href="michigan-mortgage-calculator-thumbnail.png" />
  <link rel="manifest" href="/manifest.json" />

  <!-- Social Thumbnail -->
  <link rel="image_src" href="michigan-mortgage-calculator-thumbnail.png" />

  <!-- OpenGraph -->
  <meta property="og:title" content="Michigan Mortgage Calculator" />
  <meta property="og:description" content="Fast, accurate Michigan mortgage and property tax calculator using 2024 millage rates." />
  <meta property="og:image" content="https://michiganmortgagecalculator.org/michigan-mortgage-calculator-thumbnail.png" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://michiganmortgagecalculator.org/" />

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Michigan Mortgage Calculator" />
  <meta name="twitter:description" content="Fast, accurate Michigan mortgage and property tax calculator using 2024 millage rates." />
  <meta name="twitter:image" content="https://michiganmortgagecalculator.org/michigan-mortgage-calculator-thumbnail.png" />

  <!-- JSON-LD Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "Michigan Mortgage Calculator",
    "url": "https://michiganmortgagecalculator.org/",
    "logo": "https://michiganmortgagecalculator.org/michigan-mortgage-calculator-thumbnail.png"
  }
  </script>

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "url": "https://michiganmortgagecalculator.org/",
    "name": "Michigan Mortgage Calculator",
    "potentialAction": {
      "@type": "SearchAction",
      "target": "https://michiganmortgagecalculator.org/?q={search_term_string}",
      "query-input": "required name=search_term_string"
    }
  }
  </script>

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-6HLMW6NEJ4"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-6HLMW6NEJ4');
  </script>

  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      background: #f5f5f7;
      color: #111827;
    }

    .page {
      max-width: 1100px;
      margin: 0 auto;
      padding: 24px 16px 48px;
    }

    header {
      margin-bottom: 16px;
      text-align: center;
    }

    h1 {
      margin: 4px 0 6px;
      font-size: 2rem;
      font-weight: 700;
      color: #111827;
    }

    header p {
      margin: 0;
      color: #4b5563;
      font-size: 0.95rem;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      background: #e0f2fe;
      color: #0369a1;
      font-size: 0.78rem;
    }

    .mode-toggle {
      display: flex;
      justify-content: center;
      margin-bottom: 16px;
    }

    .mode-toggle-inner {
      display: inline-flex;
      border-radius: 999px;
      background: #e5e7eb;
      border: 1px solid #d1d5db;
      overflow: hidden;
    }

    .mode-button {
      padding: 6px 14px;
      font-size: 0.8rem;
      cursor: pointer;
      border: none;
      background: transparent;
      color: #4b5563;
      flex: 1 1 0;
    }

    .mode-button.active {
      background: linear-gradient(135deg, #2563eb, #4f46e5);
      color: #ffffff;
    }

    .grid {
      display: grid;
      grid-template-columns: minmax(0, 1.3fr) minmax(0, 1fr);
      gap: 20px;
    }

    @media (max-width: 900px) {
      .grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      background: #ffffff;
      border-radius: 18px;
      padding: 18px 16px 16px;
      box-shadow: 0 12px 30px rgba(15, 23, 42, 0.08);
      border: 1px solid #e5e7eb;
    }

    .card h2 {
      margin: 0 0 8px;
      font-size: 1.15rem;
      color: #111827;
    }

    .card p {
      margin: 0 0 10px;
      font-size: 0.85rem;
      color: #6b7280;
    }

    .section-label {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: #9ca3af;
      margin-bottom: 4px;
    }

    .field-group {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 10px;
      margin-bottom: 10px;
    }

    label {
      display: block;
      font-size: 0.78rem;
      margin-bottom: 4px;
      color: #4b5563;
    }

    input[type="number"],
    select {
      width: 100%;
      padding: 7px 9px;
      border-radius: 10px;
      border: 1px solid #d1d5db;
      background: #ffffff;
      color: #111827;
      font-size: 0.85rem;
      outline: none;
    }

    input[type="number"]:focus,
    select:focus {
      border-color: #2563eb;
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.25);
    }

    .checkbox-row {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.8rem;
      color: #4b5563;
    }

    .results-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 10px;
    }

    .result-pill {
      flex: 0 0 auto;
      padding: 9px 10px;
      border-radius: 14px;
      background: #f3f4f6;
      border: 1px solid #e5e7eb;
      font-size: 0.8rem;
      min-width: 150px;
    }

    .result-pill span.label {
      display: block;
      font-size: 0.72rem;
      color: #6b7280;
    }

    .result-pill span.value {
      display: block;
      margin-top: 2px;
      font-size: 0.95rem;
      font-weight: 600;
      color: #111827;
    }

    .result-pill.total-monthly span.label {
      font-weight: 700;
    }

    .result-pill.total-monthly span.value {
      font-size: 1.1rem;
      font-weight: 700;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 0.76rem;
    }

    thead {
      background: #f3f4f6;
    }

    th,
    td {
      padding: 4px 5px;
      text-align: right;
      border-bottom: 1px solid #e5e7eb;
    }

    th:first-child,
    td:first-child {
      text-align: left;
    }

    tbody tr:nth-child(even) {
      background: #f9fafb;
    }

    .dp-row {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .dp-toggle {
      display: inline-flex;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      background: #e5e7eb;
      overflow: hidden;
      flex-shrink: 0;
      padding: 2px;
    }

    .dp-mode-button {
      border: none;
      background: transparent;
      padding: 6px 12px;
      font-size: 0.9rem;
      cursor: pointer;
      color: #4b5563;
    }

    .dp-mode-button.active {
      background: #2563eb;
      color: #ffffff;
    }

    .disclaimer {
      margin-top: 22px;
      font-size: 0.8rem;
      color: #6b7280;
      line-height: 1.4;
      text-align: center;
    }

    .small-note {
      font-size: 0.75rem;
      color: #6b7280;
      margin-top: 2px;
    }

    /* Basic vs Advanced visibility */
    .basic-only,
    .advanced-only {
      display: none;
    }
    .page.mode-basic .basic-only {
      display: block;
    }
    .page.mode-advanced .advanced-only {
      display: block;
    }
  </style>
</head>
<body>
  <div class="page mode-advanced">
    <header>
      <div class="pill">MichiganMortgageCalculator.org</div>
      <h1>Michigan Mortgage Calculator</h1>
      <p>Estimate your mortgage payment and property taxes in one place.</p>
    </header>

    <div class="mode-toggle">
      <div class="mode-toggle-inner">
        <button class="mode-button" data-mode="basic">Basic Settings</button>
        <button class="mode-button active" data-mode="advanced">Advanced Settings</button>
      </div>
    </div>

    <div class="grid">
      <!-- LEFT CARD: INPUTS -->
      <div class="card">
        <div class="section-label">Mortgage</div>
        <h2>Monthly Payment</h2>

        <p><strong>Home & loan details</strong></p>

        <div class="field-group">
          <div>
            <label for="homePriceInput">Home price</label>
            <!-- Default 300k -->
            <input id="homePriceInput" type="number" value="300000" />
          </div>

          <div>
            <label for="downPaymentInput">Down payment</label>
            <div class="dp-row">
              <!-- Default 20 and % mode -->
              <input id="downPaymentInput" type="number" value="20" />
              <div class="dp-toggle">
                <button type="button" class="dp-mode-button" data-mode="dollar">$</button>
                <button type="button" class="dp-mode-button active" data-mode="percent">%</button>
              </div>
              <input type="hidden" id="downPaymentMode" value="percent" />
            </div>
          </div>
        </div>

        <div class="field-group">
          <div>
            <label for="interestRateInput">Interest rate (annual %)</label>
            <input id="interestRateInput" type="number" placeholder="6.2" />
            <div id="pmmsNote" class="small-note"></div>
          </div>

          <div>
            <label for="loanTermYearsInput">Loan term (years)</label>
            <select id="loanTermYearsInput">
              <option value="30" selected>30</option>
              <option value="25">25</option>
              <option value="20">20</option>
              <option value="15">15</option>
              <option value="10">10</option>
            </select>
          </div>
        </div>

        <!-- BASIC MODE: manual property tax / insurance / HOA / PMI -->
        <div class="basic-only" style="margin-top: 10px;">
          <p><strong>Taxes, Insurance, HOA & PMI</strong></p>

          <div class="field-group">
            <div>
              <label for="basicTaxAnnualInput">Annual property tax (estimate)</label>
              <input id="basicTaxAnnualInput" type="number" placeholder="3600" />
            </div>

            <div>
              <label for="basicInsuranceAnnualInput">Home insurance (annual)</label>
              <input id="basicInsuranceAnnualInput" type="number" value="1200" />
            </div>
          </div>

          <div class="field-group">
            <div>
              <label for="basicHoaMonthlyInput">HOA dues (monthly)</label>
              <input id="basicHoaMonthlyInput" type="number" placeholder="0" />
            </div>

            <div>
              <label for="basicPmiAnnualInput">PMI (annual)</label>
              <input id="basicPmiAnnualInput" type="number" placeholder="0" />
            </div>
          </div>
        </div>

        <!-- ADVANCED MODE: Michigan millage property tax lookup -->
        <div class="advanced-only" style="margin-top: 14px;">
          <p><strong>Property tax inputs</strong></p>

          <div class="field-group">
            <div>
              <label for="countySelect">County</label>
              <select id="countySelect">
                <option value="">Select county…</option>
              </select>
            </div>

            <div>
              <label for="localUnitSelect">City / Township / Village</label>
              <select id="localUnitSelect" disabled>
                <option value="">Select local unit…</option>
              </select>
            </div>
          </div>

          <div class="field-group">
            <div>
              <label for="schoolSelect">School district</label>
              <select id="schoolSelect" disabled>
                <option value="">Select school district…</option>
              </select>
            </div>

            <div>
              <label>&nbsp;</label>
              <div class="checkbox-row">
                <input id="preCheckbox" type="checkbox" checked />
                <label for="preCheckbox">Primary residence (uncheck if rental or second home)</label>
              </div>
            </div>
          </div>
        </div>

        <!-- ADVANCED: Home insurance + PMI -->
        <div class="advanced-only" style="margin-top: 6px;">
          <div class="field-group">
            <div>
              <label for="annualInsuranceInput">Home insurance (annual)</label>
              <input id="annualInsuranceInput" type="number" value="1200" />
            </div>

            <div>
              <label for="pmiRateInput">PMI rate</label>
              <input id="pmiRateInput" type="number" value="0.5" />
            </div>
          </div>

          <p style="font-size: 0.75rem; color: #6b7280; margin-top: 2px;">
            PMI applies when down payment is under 20%.
          </p>
        </div>

        <!-- RESULTS -->
        <div class="results-row">
          <div class="result-pill">
            <span class="label">Principal & Interest</span>
            <span class="value" id="monthlyPaymentOutput">—</span>
          </div>

          <div class="result-pill">
            <span class="label">Estimated Property Tax (annual)</span>
            <span class="value" id="taxResult">—</span>
          </div>

          <div class="result-pill">
            <span class="label">Millage Used</span>
            <span class="value" id="millageResult">—</span>
          </div>

          <div class="result-pill">
            <span class="label">PMI (monthly)</span>
            <span class="value" id="pmiMonthlyOutput">—</span>
          </div>

          <div class="result-pill total-monthly">
            <span class="label">Total Monthly Payment</span>
            <span class="value" id="totalMonthlyOutput">—</span>
          </div>
        </div>

        <div id="taxError" class="error-text"></div>
      </div>

      <!-- RIGHT CARD: AMORTIZATION -->
      <div class="card">
        <div class="section-label">Advanced Output</div>
        <h2>Amortization Schedule</h2>
        <p>Updates automatically as you change inputs.</p>

        <div style="max-height: 380px; overflow: auto; border-radius: 10px; border: 1px solid #e5e7eb;">
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th>Payment</th>
                <th>Principal</th>
                <th>Interest</th>
                <th>Balance</th>
              </tr>
            </thead>
            <tbody id="amortizationBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="disclaimer">
      <strong>Disclaimer:</strong> This calculator is for estimates only. Property taxes use 2024 Michigan millage rates by county / local unit / school district and PRE vs non-PRE. Taxable value assumes 50% of home price. Confirm all values with your lender, assessor/treasurer, and insurance provider.
      <br><br>
      Contact: <a href="mailto:michiganmortgagecalculator@gmail.com">michiganmortgagecalculator@gmail.com</a>
    </div>
  </div>

  <script>
    /* ================================
       Global State
    ================================ */
    let millageData = {};
    // Freddie Mac PMMS fallback defaults
    let pmmsRates = {
      "30-year": 6.23,
      "15-year": 5.51
    };

    /* ================================
       Millage JSON (cache-busted)
    ================================ */
    async function loadMillageData() {
      try {
        const res = await fetch("mi_millage_2024.json?cache=" + Date.now());
        millageData = await res.json();
        populateCountySelect();
      } catch (err) {
        console.error("Error loading millage JSON:", err);
      }
    }

    function populateCountySelect() {
      const countySelect = document.getElementById("countySelect");
      countySelect.innerHTML = '<option value="">Select county…</option>';

      Object.keys(millageData).sort().forEach(county => {
        const opt = document.createElement("option");
        opt.value = county;
        opt.textContent = county;
        countySelect.appendChild(opt);
      });

      countySelect.disabled = false;
    }

    function populateLocalUnits(county) {
      const localSelect = document.getElementById("localUnitSelect");
      localSelect.innerHTML = '<option value="">Select local unit…</option>';
      localSelect.disabled = !county;

      const schoolSelect = document.getElementById("schoolSelect");
      schoolSelect.innerHTML = '<option value="">Select school district…</option>';
      schoolSelect.disabled = true;

      if (!county) return;

      Object.keys(millageData[county]).sort().forEach(localUnit => {
        const opt = document.createElement("option");
        opt.value = localUnit;
        opt.textContent = localUnit;
        localSelect.appendChild(opt);
      });
    }

    function populateSchools(county, localUnit) {
      const schoolSelect = document.getElementById("schoolSelect");
      schoolSelect.innerHTML = '<option value="">Select school district…</option>';
      schoolSelect.disabled = !(county && localUnit);

      if (!(county && localUnit)) return;

      Object.keys(millageData[county][localUnit]).sort().forEach(school => {
        const opt = document.createElement("option");
        opt.value = school;
        opt.textContent = school;
        schoolSelect.appendChild(opt);
      });
    }

    function getMillageRate(county, localUnit, school, isPRE) {
      try {
        const rec = millageData[county][localUnit][school];
        return isPRE ? rec.homestead : rec.nonhomestead;
      } catch {
        return null;
      }
    }

    /* ================================
       Freddie Mac PMMS (cache-busted)
    ================================ */
    async function loadPMMSRates() {
      const note = document.getElementById("pmmsNote");
      try {
        const res = await fetch("pmms.json?cache=" + Date.now());
        if (res.ok) {
          const pmms = await res.json();
          if (pmms["30-year"]) pmmsRates["30-year"] = parseFloat(pmms["30-year"]);
          if (pmms["15-year"]) pmmsRates["15-year"] = parseFloat(pmms["15-year"]);
        }

        if (note) {
          note.textContent = "Using latest Freddie Mac PMMS averages (national).";
        }

        setInterestRateFromPMMS();
      } catch (err) {
        console.warn("PMMS load failed; using fallback rates.", err);
        if (note) {
          note.textContent = "Using fallback Freddie Mac PMMS defaults (national).";
        }
        setInterestRateFromPMMS();
      }
    }

    function setInterestRateFromPMMS() {
      const termEl = document.getElementById("loanTermYearsInput");
      const rateEl = document.getElementById("interestRateInput");
      if (!termEl || !rateEl) return;

      const term = parseInt(termEl.value || "30", 10);

      if (term <= 20 && pmmsRates["15-year"]) {
        rateEl.value = pmmsRates["15-year"].toFixed(2);
      } else if (pmmsRates["30-year"]) {
        rateEl.value = pmmsRates["30-year"].toFixed(2);
      }
    }

    /* ================================
       Calculation
    ================================ */
    function calculate() {
      const page = document.querySelector(".page");
      const mode = page.classList.contains("mode-basic") ? "basic" : "advanced";

      const homePrice = +document.getElementById("homePriceInput").value || 0;
      const dpValue = +document.getElementById("downPaymentInput").value || 0;
      const dpMode = document.getElementById("downPaymentMode").value;

      const rate = (+document.getElementById("interestRateInput").value || 0) / 100;
      const years = +document.getElementById("loanTermYearsInput").value || 30;
      const months = years * 12;

      if (!homePrice || homePrice <= 0) {
        updateOutputsNaN();
        return;
      }

      const downPayment =
        dpMode === "percent" ? homePrice * (dpValue / 100) : dpValue;

      const loanAmount = Math.max(homePrice - downPayment, 0);
      const monthlyRate = rate / 12;
      let PI = 0;

      if (monthlyRate > 0 && months > 0) {
        PI = (monthlyRate * loanAmount) / (1 - Math.pow(1 + monthlyRate, -months));
      } else if (months > 0) {
        PI = loanAmount / months;
      }

      document.getElementById("monthlyPaymentOutput").textContent =
        isFinite(PI) ? PI.toFixed(2) : "—";

      /* ===== PMI ===== */
      let pmiMonthly = 0;
      const pmiRate = (+document.getElementById("pmiRateInput").value || 0) / 100;
      const ltv = homePrice > 0 ? loanAmount / homePrice : 0;

      if (ltv > 0.8 && pmiRate > 0) {
        pmiMonthly = (loanAmount * pmiRate) / 12;
      }

      document.getElementById("pmiMonthlyOutput").textContent =
        isFinite(pmiMonthly) && pmiMonthly > 0 ? pmiMonthly.toFixed(2) : "—";

      /* ===== PROPERTY TAXES ===== */
      let annualTax = 0;
      let millageUsed = "—";

      if (mode === "basic") {
        annualTax = +document.getElementById("basicTaxAnnualInput").value || 0;
      } else {
        const county = document.getElementById("countySelect").value;
        const localUnit = document.getElementById("localUnitSelect").value;
        const school = document.getElementById("schoolSelect").value;
        const isPRE = document.getElementById("preCheckbox").checked;

        const mill = getMillageRate(county, localUnit, school, isPRE);
        if (mill != null) {
          millageUsed = mill.toFixed(4) + " mills";
          annualTax = 0.5 * homePrice * (mill / 1000);
        }
      }

      document.getElementById("taxResult").textContent =
        annualTax ? annualTax.toFixed(2) : "—";
      document.getElementById("millageResult").textContent = millageUsed;

      /* Home insurance */
      let annualInsurance = 1200;
      if (mode === "basic") {
        annualInsurance = +document.getElementById("basicInsuranceAnnualInput").value || 0;
      } else {
        annualInsurance = +document.getElementById("annualInsuranceInput").value || 0;
      }

      const hoaMonthly =
        mode === "basic"
          ? +document.getElementById("basicHoaMonthlyInput").value || 0
          : 0;

      const taxMonthly = annualTax / 12;
      const insMonthly = annualInsurance / 12;

      const totalMonthly = PI + pmiMonthly + taxMonthly + insMonthly + hoaMonthly;

      document.getElementById("totalMonthlyOutput").textContent =
        isFinite(totalMonthly) ? totalMonthly.toFixed(2) : "—";

      /* ===== AMORTIZATION TABLE ===== */
      buildAmortization(loanAmount, monthlyRate, months, PI);
    }

    function updateOutputsNaN() {
      document.getElementById("monthlyPaymentOutput").textContent = "—";
      document.getElementById("taxResult").textContent = "—";
      document.getElementById("millageResult").textContent = "—";
      document.getElementById("pmiMonthlyOutput").textContent = "—";
      document.getElementById("totalMonthlyOutput").textContent = "—";
      document.getElementById("amortizationBody").innerHTML = "";
    }

    function buildAmortization(principal, monthlyRate, months, payment) {
      const tbody = document.getElementById("amortizationBody");
      tbody.innerHTML = "";

      if (!principal || !months || !payment || !isFinite(payment)) return;

      let balance = principal;

      for (let i = 1; i <= months; i++) {
        const interest = balance * monthlyRate;
        const principalPaid = payment - interest;
        balance -= principalPaid;
        if (balance < 0) balance = 0;

        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${i}</td>
          <td>${payment.toFixed(2)}</td>
          <td>${principalPaid.toFixed(2)}</td>
          <td>${interest.toFixed(2)}</td>
          <td>${balance.toFixed(2)}</td>
        `;
        tbody.appendChild(row);

        if (balance <= 0) break;
      }
    }

    /* ================================
       Mode switching
    ================================ */
    document.querySelectorAll(".mode-button").forEach(btn => {
      btn.addEventListener("click", () => {
        document
          .querySelectorAll(".mode-button")
          .forEach(b => b.classList.remove("active"));
        btn.classList.add("active");

        const mode = btn.dataset.mode;
        const page = document.querySelector(".page");
        if (mode === "basic") {
          page.classList.add("mode-basic");
          page.classList.remove("mode-advanced");
        } else {
          page.classList.add("mode-advanced");
          page.classList.remove("mode-basic");
        }

        calculate();
      });
    });

    /* Down payment mode toggle */
    document.querySelectorAll(".dp-mode-button").forEach(btn => {
      btn.addEventListener("click", () => {
        document
          .querySelectorAll(".dp-mode-button")
          .forEach(b => b.classList.remove("active"));
        btn.classList.add("active");

        const mode = btn.dataset.mode;
        document.getElementById("downPaymentMode").value = mode;

        calculate();
      });
    });

    /* Input listeners (auto-calc) */
    [
      "homePriceInput",
      "downPaymentInput",
      "interestRateInput",
      "loanTermYearsInput",
      "basicTaxAnnualInput",
      "basicInsuranceAnnualInput",
      "basicHoaMonthlyInput",
      "basicPmiAnnualInput",
      "annualInsuranceInput",
      "pmiRateInput"
    ].forEach(id => {
      const el = document.getElementById(id);
      if (el) {
        const evt = id === "loanTermYearsInput" ? "change" : "input";
        el.addEventListener(evt, () => {
          if (id === "loanTermYearsInput") {
            setInterestRateFromPMMS();
          }
          calculate();
        });
      }
    });

    /* Dropdown listeners */
    document.getElementById("countySelect").addEventListener("change", e => {
      populateLocalUnits(e.target.value);
      calculate();
    });

    document.getElementById("localUnitSelect").addEventListener("change", e => {
      const county = document.getElementById("countySelect").value;
      populateSchools(county, e.target.value);
      calculate();
    });

    document.getElementById("schoolSelect").addEventListener("change", calculate);
    document.getElementById("preCheckbox").addEventListener("change", calculate);

    /* Initial load */
    window.addEventListener("DOMContentLoaded", async () => {
      await loadMillageData();
      await loadPMMSRates();
      calculate();
    });
  </script>
</body>
</html>
