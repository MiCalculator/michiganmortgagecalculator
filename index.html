<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Michigan Mortgage & Property Tax Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-6HLMW6NEJ4"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-6HLMW6NEJ4');
  </script>

  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      background: #f5f5f7;
      color: #111827;
    }

    .page {
      max-width: 1100px;
      margin: 0 auto;
      padding: 24px 16px 48px;
    }

    header {
      margin-bottom: 16px;
      text-align: center;
    }

    h1 {
      margin: 4px 0 6px;
      font-size: 2rem;
      font-weight: 700;
      color: #111827;
    }

    header p {
      margin: 0;
      color: #4b5563;
      font-size: 0.95rem;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      background: #e0f2fe;
      color: #0369a1;
      font-size: 0.78rem;
    }

    .mode-toggle {
      display: flex;
      justify-content: center;
      margin-bottom: 16px;
    }

    .mode-toggle-inner {
      display: inline-flex;
      border-radius: 999px;
      background: #e5e7eb;
      border: 1px solid #d1d5db;
      overflow: hidden;
    }

    .mode-button {
      padding: 6px 14px;
      font-size: 0.8rem;
      cursor: pointer;
      border: none;
      background: transparent;
      color: #4b5563;
      flex: 1 1 0;
    }

    .mode-button.active {
      background: linear-gradient(135deg, #2563eb, #4f46e5);
      color: #ffffff;
    }

    .grid {
      display: grid;
      grid-template-columns: minmax(0, 1.3fr) minmax(0, 1fr);
      gap: 20px;
    }

    @media (max-width: 900px) {
      .grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      background: #ffffff;
      border-radius: 18px;
      padding: 18px 16px 16px;
      box-shadow: 0 12px 30px rgba(15, 23, 42, 0.08);
      border: 1px solid #e5e7eb;
    }

    .card h2 {
      margin: 0 0 8px;
      font-size: 1.15rem;
      color: #111827;
    }

    .card p {
      margin: 0 0 10px;
      font-size: 0.85rem;
      color: #6b7280;
    }

    .section-label {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: #9ca3af;
      margin-bottom: 4px;
    }

    .field-group {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 10px;
      margin-bottom: 10px;
    }

    label {
      display: block;
      font-size: 0.78rem;
      margin-bottom: 4px;
      color: #4b5563;
    }

    input[type="number"],
    select {
      width: 100%;
      padding: 7px 9px;
      border-radius: 10px;
      border: 1px solid #d1d5db;
      background: #ffffff;
      color: #111827;
      font-size: 0.85rem;
      outline: none;
    }

    input[type="number"]:focus,
    select:focus {
      border-color: #2563eb;
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.25);
    }

    .checkbox-row {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.8rem;
      margin: 6px 0 10px;
      color: #4b5563;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 8px 18px;
      background: linear-gradient(135deg, #2563eb, #4f46e5);
      color: #ffffff;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 8px 20px rgba(37, 99, 235, 0.25);
    }

    .results-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 10px;
    }

    .result-pill {
      flex: 0 0 auto;
      padding: 9px 10px;
      border-radius: 14px;
      background: #f3f4f6;
      border: 1px solid #e5e7eb;
      font-size: 0.8rem;
      min-width: 150px;
    }

    .result-pill span.label {
      display: block;
      font-size: 0.72rem;
      color: #6b7280;
    }

    .result-pill span.value {
      display: block;
      margin-top: 2px;
      font-size: 0.95rem;
      font-weight: 600;
      color: #111827;
    }

    .error-text {
      color: #b91c1c;
      font-size: 0.78rem;
      margin-top: 4px;
    }

    .disclaimer {
      margin-top: 22px;
      font-size: 0.8rem;
      color: #6b7280;
      line-height: 1.4;
      text-align: center;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 0.76rem;
    }

    thead {
      background: #f3f4f6;
    }

    th,
    td {
      padding: 4px 5px;
      text-align: right;
      border-bottom: 1px solid #e5e7eb;
    }

    th:first-child,
    td:first-child {
      text-align: left;
    }

    th {
      font-weight: 600;
      color: #6b7280;
    }

    tbody tr:nth-child(even) {
      background: #f9fafb;
    }

    /* Mode visibility */
    .advanced-only {
      display: none;
    }

    .basic-only {
      display: none;
    }

    .mode-advanced .advanced-only {
      display: block;
    }

    .mode-basic .basic-only {
      display: block;
    }

    .mode-basic .advanced-only {
      display: none;
    }

    /* Down payment $ / % toggle */
    .dp-row {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .dp-toggle {
      display: inline-flex;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      background: #e5e7eb;
      overflow: hidden;
      flex-shrink: 0;
    }

    .dp-mode-button {
      border: none;
      background: transparent;
      padding: 4px 8px;
      font-size: 0.75rem;
      cursor: pointer;
      color: #4b5563;
    }

    .dp-mode-button.active {
      background: #2563eb;
      color: #ffffff;
    }
  </style>
</head>
<body>
  <!-- default to advanced mode -->
  <div class="page mode-advanced">
    <header>
      <div class="pill">MichiganMortgageCalculator.org</div>
      <h1>Michigan Mortgage Calculator</h1>
      <p>Estimate your mortgage payment and property taxes in one place.</p>
    </header>

    <div class="mode-toggle">
      <div class="mode-toggle-inner">
        <button class="mode-button" data-mode="basic">Basic Settings</button>
        <button class="mode-button active" data-mode="advanced">Advanced Settings</button>
      </div>
    </div>

    <div class="grid">
      <!-- LEFT CARD: INPUTS -->
      <div class="card">
        <div class="section-label">Mortgage</div>
        <h2>Monthly Payment</h2>

        <p><strong>Home & loan details</strong></p>
        <div class="field-group">
          <div>
            <label for="homePriceInput">Home price</label>
            <input id="homePriceInput" type="number" inputmode="decimal" placeholder="300000" />
          </div>
          <div>
            <label for="downPaymentInput">Down payment</label>
            <div class="dp-row">
              <input id="downPaymentInput" type="number" inputmode="decimal" placeholder="60000" />
              <div class="dp-toggle">
                <button type="button" class="dp-mode-button active" data-mode="dollar">$</button>
                <button type="button" class="dp-mode-button" data-mode="percent">%</button>
              </div>
              <input type="hidden" id="downPaymentMode" value="dollar" />
            </div>
          </div>
        </div>

        <div class="field-group">
          <div>
            <label for="interestRateInput">Interest rate (annual %)</label>
            <input id="interestRateInput" type="number" inputmode="decimal" value="6.2" placeholder="6.2" />
          </div>
          <div>
            <label for="loanTermYearsInput">Loan term (years)</label>
            <input id="loanTermYearsInput" type="number" inputmode="decimal" placeholder="30" />
          </div>
        </div>

        <!-- BASIC: manual tax / insurance / HOA / PMI -->
        <div class="basic-only" style="margin-top: 10px;">
          <p><strong>Taxes, Insurance, HOA & PMI</strong></p>
          <div class="field-group">
            <div>
              <label for="basicTaxAnnualInput">Annual property tax (estimate)</label>
              <input id="basicTaxAnnualInput" type="number" inputmode="decimal" placeholder="3600" />
            </div>
            <div>
              <label for="basicInsuranceAnnualInput">Home insurance (annual)</label>
              <input id="basicInsuranceAnnualInput" type="number" inputmode="decimal" value="1200" placeholder="1200" />
            </div>
          </div>
          <div class="field-group">
            <div>
              <label for="basicHoaMonthlyInput">HOA dues (monthly)</label>
              <input id="basicHoaMonthlyInput" type="number" inputmode="decimal" placeholder="0" />
            </div>
            <div>
              <label for="basicPmiAnnualInput">PMI (annual)</label>
              <input id="basicPmiAnnualInput" type="number" inputmode="decimal" placeholder="0" />
            </div>
          </div>
        </div>

        <!-- ADVANCED: property tax inputs (Michigan 2024 millage) -->
        <div class="advanced-only" style="margin-top: 12px;">
          <p><strong>Property tax inputs</strong></p>
          <div class="field-group">
            <div>
              <label for="countySelect">County</label>
              <select id="countySelect">
                <option value="">Select county…</option>
              </select>
            </div>
            <div>
              <label for="localUnitSelect">City / Township / Village</label>
              <select id="localUnitSelect" disabled>
                <option value="">Select local unit…</option>
              </select>
            </div>
          </div>
          <div class="field-group">
            <div>
              <label for="schoolSelect">School district</label>
              <select id="schoolSelect" disabled>
                <option value="">Select school district…</option>
              </select>
            </div>
            <div>
              <label>&nbsp;</label>
              <div class="checkbox-row">
                <input id="preCheckbox" type="checkbox" checked />
                <label for="preCheckbox" style="margin: 0;">Primary residence (uncheck if rental or second home)</label>
              </div>
            </div>
          </div>
        </div>

        <!-- ADVANCED: Home Insurance + PMI inline -->
        <div class="advanced-only" style="margin-top: 4px;">
          <div class="field-group">
            <div>
              <label for="annualInsuranceInput">Home insurance (annual)</label>
              <input id="annualInsuranceInput" type="number" inputmode="decimal" value="1200" placeholder="1200" />
            </div>
            <div>
              <label for="pmiRateInput">PMI rate</label>
              <input id="pmiRateInput" type="number" inputmode="decimal" value="0.5" placeholder="0.5" />
            </div>
          </div>
          <p style="font-size:0.75rem; color:#6b7280; margin-top:2px;">
            PMI is applied when down payment is less than 20% of the home price.
          </p>
        </div>

        <div style="margin-top: 14px; display: flex; gap: 10px; flex-wrap: wrap;">
          <button id="calculateButton" type="button">Calculate payment</button>
        </div>

        <div class="results-row">
          <div class="result-pill">
            <span class="label">Principal & interest</span>
            <span class="value" id="monthlyPaymentOutput">—</span>
          </div>
          <div class="result-pill">
            <span class="label">Estimated property tax (annual)</span>
            <span class="value" id="taxResult">—</span>
          </div>
          <div class="result-pill">
            <span class="label">Millage used</span>
            <span class="value" id="millageResult">—</span>
          </div>
          <div class="result-pill">
            <span class="label">PMI (monthly)</span>
            <span class="value" id="pmiMonthlyOutput">—</span>
          </div>
          <div class="result-pill">
            <span class="label">Total monthly (PITI + PMI)</span>
            <span class="value" id="totalMonthlyOutput">—</span>
          </div>
        </div>

        <div id="taxError" class="error-text"></div>
      </div>

      <!-- RIGHT CARD: AMORTIZATION -->
      <div class="card">
        <div class="section-label">Advanced output</div>
        <h2>Amortization Schedule</h2>
        <p>Updates when you change inputs.</p>

        <div style="max-height: 380px; overflow: auto; border-radius: 10px; border: 1px solid #e5e7eb;">
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th>Payment</th>
                <th>Principal</th>
                <th>Interest</th>
                <th>Balance</th>
              </tr>
            </thead>
            <tbody id="amortizationBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="disclaimer">
      <strong>Disclaimer:</strong> This calculator is for estimates only. Figures may not reflect your actual
      mortgage payment, tax bill, PMI, HOA dues, or insurance cost. Property tax estimates in Advanced mode use
      2024 Michigan millage rates by county / local unit / school district with PRE vs non-PRE. Taxable value is
      assumed to be 50% of home price. Always confirm numbers with your lender, assessor/treasurer, HOA, and
      insurance provider.
      <br/><br/>
      Contact us at <a href="mailto:michiganmortgagecalculator@gmail.com">michiganmortgagecalculator@gmail.com</a>.
    </div>
  </div>

  <script>
    /****************************************************
     * Michigan Mortgage Calculator (2024 millage)
     ****************************************************/
    let millageData = {};

    document.addEventListener("DOMContentLoaded", () => {
      const page = document.querySelector(".page");

      // Mode toggle
      const modeButtons = document.querySelectorAll(".mode-button");
      modeButtons.forEach(btn => {
        btn.addEventListener("click", () => {
          modeButtons.forEach(b => b.classList.remove("active"));
          btn.classList.add("active");
          const mode = btn.dataset.mode;
          if (mode === "advanced") {
            page.classList.add("mode-advanced");
            page.classList.remove("mode-basic");
          } else {
            page.classList.add("mode-basic");
            page.classList.remove("mode-advanced");
          }
          calculateMortgage();
        });
      });

      // Down payment $ / %
      const dpButtons = document.querySelectorAll(".dp-mode-button");
      const dpModeHidden = document.getElementById("downPaymentMode");
      const dpInput = document.getElementById("downPaymentInput");

      dpButtons.forEach(btn => {
        btn.addEventListener("click", () => {
          dpButtons.forEach(b => b.classList.remove("active"));
          btn.classList.add("active");
          const mode = btn.dataset.mode;
          dpModeHidden.value = mode;
          if (dpInput) dpInput.placeholder = mode === "percent" ? "20" : "60000";
          calculateMortgage();
        });
      });

      loadMillageData();
      wireEvents();
    });

    async function loadMillageData() {
      try {
        const res = await fetch("mi_millage_2024.json");
        if (!res.ok) {
          console.error("Failed to load millage JSON:", res.status, res.statusText);
          return;
        }
        millageData = await res.json();
        populateCountyOptions();
      } catch (err) {
        console.error("Error loading millage JSON:", err);
      }
    }

    // Dropdown helpers (Advanced mode only)
    function populateCountyOptions() {
      const countySelect = document.getElementById("countySelect");
      if (!countySelect || !millageData) return;

      countySelect.innerHTML = "<option value=''>Select county…</option>";
      Object.keys(millageData)
        .sort()
        .forEach(cty => {
          const opt = document.createElement("option");
          opt.value = cty;
          opt.textContent = cty;
          countySelect.appendChild(opt);
        });
      countySelect.disabled = false;
    }

    function populateLocalUnits(countyName) {
      const localUnitSelect = document.getElementById("localUnitSelect");
      const schoolSelect = document.getElementById("schoolSelect");
      if (!localUnitSelect || !schoolSelect) return;

      localUnitSelect.innerHTML = "<option value=''>Select local unit…</option>";
      schoolSelect.innerHTML = "<option value=''>Select school district…</option>";
      schoolSelect.disabled = true;

      const countyObj = millageData[countyName];
      if (!countyName || !countyObj) {
        localUnitSelect.disabled = true;
        return;
      }

      Object.keys(countyObj)
        .sort()
        .forEach(lu => {
          const opt = document.createElement("option");
          opt.value = lu;
          opt.textContent = lu;
          localUnitSelect.appendChild(opt);
        });

      localUnitSelect.disabled = false;
    }

    function populateSchools(countyName, localUnitName) {
      const schoolSelect = document.getElementById("schoolSelect");
      if (!schoolSelect) return;

      schoolSelect.innerHTML = "<option value=''>Select school district…</option>";

      const countyObj = millageData[countyName];
      if (!countyName || !localUnitName || !countyObj || !countyObj[localUnitName]) {
        schoolSelect.disabled = true;
        return;
      }

      Object.keys(countyObj[localUnitName])
        .sort()
        .forEach(sc => {
          const opt = document.createElement("option");
          opt.value = sc;
          opt.textContent = sc;
          schoolSelect.appendChild(opt);
        });

      schoolSelect.disabled = false;
    }

    function getMillage({ county, localUnit, school, isPRE }) {
      if (!millageData || !county || !localUnit || !school) return null;
      const countyObj = millageData[county];
      const unitObj = countyObj && countyObj[localUnit];
      const schoolObj = unitObj && unitObj[school];
      if (!schoolObj) return null;
      const raw = isPRE ? schoolObj.homestead : schoolObj.nonhomestead;
      const rate = typeof raw === "number" ? raw : parseFloat(raw);
      return isNaN(rate) ? null : rate;
    }

    // Helpers
    function parseNumber(id) {
      const el = document.getElementById(id);
      if (!el) return 0;
      const v = parseFloat((el.value || "").replace(/,/g, ""));
      return isNaN(v) ? 0 : v;
    }

    function formatCurrency(num) {
      if (num == null || isNaN(num)) return "—";
      return num.toLocaleString("en-US", {
        style: "currency",
        currency: "USD",
        maximumFractionDigits: 2
      });
    }

    // Advanced property tax (JSON)
    function calculatePropertyTaxAdvanced() {
      const taxError = document.getElementById("taxError");
      if (taxError) taxError.textContent = "";

      const price = parseNumber("homePriceInput");
      const taxDisplay = document.getElementById("taxResult");
      const millageDisplay = document.getElementById("millageResult");

      const countyEl = document.getElementById("countySelect");
      const localUnitEl = document.getElementById("localUnitSelect");
      const schoolEl = document.getElementById("schoolSelect");
      const preEl = document.getElementById("preCheckbox");

      if (!countyEl || !localUnitEl || !schoolEl) return { tax: 0, millage: 0 };

      const county = countyEl.value;
      const localUnit = localUnitEl.value;
      const school = schoolEl.value;
      const isPRE = preEl ? preEl.checked : true;

      if (!county || !localUnit || !school) {
        if (taxDisplay) taxDisplay.textContent = "—";
        if (millageDisplay) millageDisplay.textContent = "—";
        // Don't spam error until all three are picked AND there's a price
        if (taxError && price) {
          taxError.textContent = "Select county, local unit, and school district.";
        }
        return { tax: 0, millage: 0 };
      }

      const millage = getMillage({ county, localUnit, school, isPRE });
      if (millage == null) {
        if (taxDisplay) taxDisplay.textContent = "—";
        if (millageDisplay) millageDisplay.textContent = "—";
        if (taxError) taxError.textContent = "No millage found for this combination.";
        return { tax: 0, millage: 0 };
      }

      if (millageDisplay) millageDisplay.textContent = millage.toFixed(4) + " mills";

      if (!price) {
        if (taxDisplay) taxDisplay.textContent = "—";
        return { tax: 0, millage };
      }

      const taxableValue = price * 0.5;
      const tax = (taxableValue / 1000) * millage;
      if (taxDisplay) taxDisplay.textContent = formatCurrency(tax);

      return { tax, millage };
    }

    // Mortgage + branch by mode
    function calculateMortgage() {
      const page = document.querySelector(".page");
      const isAdvanced = page && page.classList.contains("mode-advanced");

      // Core mortgage (both modes)
      const price = parseNumber("homePriceInput");

      const dpModeEl = document.getElementById("downPaymentMode");
      const dpMode = dpModeEl ? dpModeEl.value : "dollar";
      const dpInputVal = parseNumber("downPaymentInput");
      const down = dpMode === "percent" ? price * (dpInputVal / 100) : dpInputVal;

      const rate = parseNumber("interestRateInput");
      const years = parseNumber("loanTermYearsInput");

      const principal = Math.max(price - down, 0);
      const nPayments = years * 12;
      const monthlyRate = rate > 0 ? (rate / 100) / 12 : 0;

      let monthlyPI = 0;
      if (monthlyRate > 0 && nPayments > 0) {
        const factor = Math.pow(1 + monthlyRate, nPayments);
        monthlyPI = principal * (monthlyRate * factor) / (factor - 1);
      } else if (nPayments > 0) {
        monthlyPI = principal / nPayments;
      }

      const monthlyPaymentOutput = document.getElementById("monthlyPaymentOutput");
      if (monthlyPaymentOutput) monthlyPaymentOutput.textContent = formatCurrency(monthlyPI);

      let monthlyTax = 0;
      let monthlyIns = 0;
      let monthlyPMI = 0;
      let monthlyHOA = 0;

      const pmiMonthlyOutput = document.getElementById("pmiMonthlyOutput");
      const taxResultSpan = document.getElementById("taxResult");
      const millageResultSpan = document.getElementById("millageResult");

      if (isAdvanced) {
        // Advanced: JSON millage + insurance + PMI from rate
        const taxResultObj = calculatePropertyTaxAdvanced();
        const annualTax = taxResultObj && taxResultObj.tax ? taxResultObj.tax : 0;
        monthlyTax = annualTax / 12;

        const annualInsurance = parseNumber("annualInsuranceInput");
        monthlyIns = annualInsurance / 12;

        const pmiRate = parseNumber("pmiRateInput"); // percent of loan, annual
        if (pmiRate > 0 && price > 0) {
          const ltv = price > 0 ? principal / price : 0;
          if (ltv > 0.8) {
            monthlyPMI = (pmiRate / 100) * principal / 12;
          }
        }
        if (pmiMonthlyOutput) {
          pmiMonthlyOutput.textContent = monthlyPMI > 0 ? formatCurrency(monthlyPMI) : "—";
        }
        // taxResult & millageResult handled in calculatePropertyTaxAdvanced
      } else {
        // Basic: manual annual tax, annual insurance, HOA monthly, annual PMI
        const annualTaxManual = parseNumber("basicTaxAnnualInput");
        monthlyTax = annualTaxManual / 12;

        const annualInsBasic = parseNumber("basicInsuranceAnnualInput");
        monthlyIns = annualInsBasic / 12;

        monthlyHOA = parseNumber("basicHoaMonthlyInput");

        const annualPmiBasic = parseNumber("basicPmiAnnualInput");
        monthlyPMI = annualPmiBasic / 12;

        if (taxResultSpan) {
          taxResultSpan.textContent = annualTaxManual ? formatCurrency(annualTaxManual) : "—";
        }
        if (millageResultSpan) {
          millageResultSpan.textContent = "—";
        }
        if (pmiMonthlyOutput) {
          pmiMonthlyOutput.textContent = monthlyPMI ? formatCurrency(monthlyPMI) : "—";
        }
      }

      const totalMonthly = monthlyPI + monthlyTax + monthlyIns + monthlyPMI + monthlyHOA;
      const totalMonthlyOutput = document.getElementById("totalMonthlyOutput");
      if (totalMonthlyOutput) totalMonthlyOutput.textContent = formatCurrency(totalMonthly);

      buildAmortizationTable(principal, monthlyRate, nPayments, monthlyPI);
    }

    function buildAmortizationTable(principal, monthlyRate, nPayments, monthlyPI) {
      const tbody = document.getElementById("amortizationBody");
      if (!tbody) return;

      tbody.innerHTML = "";
      if (!principal || !nPayments || !monthlyPI) return;

      let balance = principal;
      for (let i = 1; i <= nPayments; i++) {
        const interest = balance * monthlyRate;
        const principalPaid = monthlyPI - interest;
        balance -= principalPaid;
        if (balance < 0) balance = 0;

        const tr = document.createElement("tr");

        const tdN = document.createElement("td");
        const tdPay = document.createElement("td");
        const tdPrin = document.createElement("td");
        const tdInt = document.createElement("td");
        const tdBal = document.createElement("td");

        tdN.textContent = i;
        tdPay.textContent = formatCurrency(monthlyPI);
        tdPrin.textContent = formatCurrency(principalPaid);
        tdInt.textContent = formatCurrency(interest);
        tdBal.textContent = formatCurrency(balance);

        tr.appendChild(tdN);
        tr.appendChild(tdPay);
        tr.appendChild(tdPrin);
        tr.appendChild(tdInt);
        tr.appendChild(tdBal);
        tbody.appendChild(tr);

        if (balance <= 0) break;
      }
    }

    function wireEvents() {
      const calcBtn = document.getElementById("calculateButton");
      if (calcBtn) {
        calcBtn.addEventListener("click", (e) => {
          e.preventDefault();
          calculateMortgage();
        });
      }

      const countySelect = document.getElementById("countySelect");
      const localUnitSelect = document.getElementById("localUnitSelect");
      const schoolSelect = document.getElementById("schoolSelect");
      const preEl = document.getElementById("preCheckbox");

      if (countySelect) {
        countySelect.addEventListener("change", () => {
          populateLocalUnits(countySelect.value);
          calculateMortgage();
        });
      }

      if (localUnitSelect) {
        localUnitSelect.addEventListener("change", () => {
          const countyName = countySelect ? countySelect.value : "";
          populateSchools(countyName, localUnitSelect.value);
          calculateMortgage();
        });
      }

      if (schoolSelect) {
        schoolSelect.addEventListener("change", () => calculateMortgage());
      }

      if (preEl) {
        preEl.addEventListener("change", () => calculateMortgage());
      }

      // Auto-calc on key numeric fields
      const autoFields = [
        "homePriceInput",
        "downPaymentInput",
        "interestRateInput",
        "loanTermYearsInput",
        "basicTaxAnnualInput",
        "basicInsuranceAnnualInput",
        "basicHoaMonthlyInput",
        "basicPmiAnnualInput",
        "annualInsuranceInput",
        "pmiRateInput"
      ];

      autoFields.forEach(id => {
        const el = document.getElementById(id);
        if (el) {
          el.addEventListener("input", () => calculateMortgage());
        }
      });
    }
  </script>
</body>
</html>
